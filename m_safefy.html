<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="UTF-8" />
        <title>Logsewa Safety Practices Mock Test</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                background: linear-gradient(135deg, #e0e7ff, #c3dafe);
                margin: 0;
                padding: 2rem;
                color: #333;
                min-height: 100vh;
            }

            .quiz-container {
                max-width: 900px;
                margin: auto;
                background: #fff;
                padding: 2rem;
                border-radius: 16px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            h1 {
                text-align: center;
                margin-bottom: 1.5rem;
                color: #1e3a8a;
                font-size: 2rem;
                font-weight: 700;
            }

            h2 {
                text-align: center;
                color: #1e3a8a;
                margin: 1rem 0;
            }

            .quiz-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                padding: 1rem;
                background: #f8fafc;
                border-radius: 8px;
            }

            .timer {
                font-size: 1.2rem;
                font-weight: 600;
                color: #d81b60;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: #e5e7eb;
                border-radius: 4px;
                overflow: hidden;
                margin-bottom: 1.5rem;
            }

            .progress {
                height: 100%;
                background: #3b82f6;
                transition: width 0.3s ease;
            }

            .question {
                margin-bottom: 2rem;
                padding: 1.5rem;
                background: #f8fafc;
                border-radius: 12px;
                animation: fadeIn 0.5s;
                transition: transform 0.2s ease;
            }

            .question:hover {
                transform: translateY(-2px);
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            .question p {
                font-size: 1.2rem;
                font-weight: 600;
                color: #1e3a8a;
                margin-bottom: 1rem;
            }

            .options button {
                display: block;
                width: 100%;
                padding: 1rem;
                margin: 0.5rem 0;
                background: #ffffff;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
                color: #374151;
            }

            .options button:hover:not(:disabled) {
                background: #f3f4f6;
                border-color: #3b82f6;
                transform: translateX(4px);
            }

            .options button.correct {
                background: #bbf7d0;
                border-color: #22c55e;
                color: #166534;
                animation: pulse 0.5s;
            }

            .options button.wrong {
                background: #fecaca;
                border-color: #ef4444;
                color: #991b1b;
                animation: shake 0.3s;
            }

            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }

            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }

            .options button:disabled {
                cursor: not-allowed;
                opacity: 0.7;
            }

            .explanation {
                display: none;
                margin-top: 1rem;
                padding: 1rem;
                background: #eff6ff;
                border-radius: 8px;
                color: #1e3a8a;
                font-size: 0.95rem;
            }

            .skip-button {
                background: #fff3cd;
                margin-top: 1rem;
                padding: 0.75rem;
                width: 100%;
                border: 1px solid #ffca28;
                border-radius: 8px;
                cursor: pointer;
                transition: background 0.3s ease;
            }

            .skip-button:hover {
                background: #ffecd3;
            }

            .next-button {
                background: #3b82f6;
                color: #fff;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                margin-top: 1rem;
                display: block;
                width: 100%;
                text-align: center;
                transition: background 0.3s ease;
            }

            .next-button:hover:not(:disabled) {
                background: #2563eb;
            }

            .next-button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            .score-container {
                text-align: center;
                margin-top: 2rem;
                padding: 1.5rem;
                background: #f8fafc;
                border-radius: 12px;
            }

            .score {
                font-size: 1.5rem;
                font-weight: 700;
                color: #1e3a8a;
            }

            .results-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 1rem;
                font-size: 0.95rem;
            }

            .results-table th, .results-table td {
                border: 1px solid #e5e7eb;
                padding: 0.75rem;
                text-align: left;
            }

            .results-table th {
                background: #f8fafc;
                color: #1e3a8a;
                font-weight: 600;
            }

            .results-table .correct {
                color: #166534;
                font-weight: bold;
            }

            .results-table .wrong {
                color: #991b1b;
                font-weight: bold;
            }

            .results-table .skipped, .results-table .not-attempted {
                color: #d97706;
                font-weight: bold;
            }

            .hidden {
                display: none;
            }

            .restart-button {
                background: #22c55e;
                color: #fff;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                margin: 1rem auto;
                display: block;
                width: 100%;
                text-align: center;
                transition: background 0.3s ease;
            }

            .restart-button:hover {
                background: #16a34a;
            }

            @media (max-width: 600px) {
                body {
                    padding: 1rem;
                }

                .quiz-container {
                    padding: 1rem;
                }

                h1 {
                    font-size: 1.8rem;
                }

                .question p {
                    font-size: 1rem;
                }

                .options button, .skip-button, .next-button, .restart-button {
                    font-size: 0.9rem;
                    padding: 0.8rem;
                }

                .results-table th, .results-table td {
                    padding: 0.5rem;
                    font-size: 0.85rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="quiz-container">
            <h1>Logsewa Safety Practices Mock Test</h1>
            <div class="quiz-header">
                <div class="timer" id="timer">Time: 00:00</div>
                <div class="score" id="current-score">Score: 0/39</div>
            </div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div id="quiz"></div>
            <div class="score-container">
                <div class="score" id="score"></div>
                <div id="results" class="hidden">
                    <h2>Quiz Results</h2>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Your Answer</th>
                                <th>Correct Answer</th>
                                <th>Status</th>
                                <th>Explanation</th>
                            </tr>
                        </thead>
                        <tbody id="results-body"></tbody>
                    </table>
                    <button class="restart-button" onclick="restartQuiz()">Restart Quiz</button>
                </div>
            </div>
        </div>

        <audio id="correct-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
        <audio id="wrong-sound" src="https://www.soundjay.com/buttons/beep-02.mp3"></audio>

        <script>
            const questions = [
                // 1.1 Importance of Safety (6 MCQs)
                {
                    q: "Why is workplace safety critical in industrial settings?",
                    options: ["To increase production speed", "To reduce workplace injuries and illnesses", "To decrease worker training requirements", "To eliminate the need for maintenance"],
                    answer: 1,
                    explanation: "Workplace safety minimizes injuries and illnesses, ensuring worker well-being and reducing costs, as supported by the Bureau of Labor Statistics reporting over 2 million work-related injuries in 2021."
                },
                {
                    q: "What is a key benefit of implementing safety practices in a mechanical workshop?",
                    options: ["Higher equipment costs", "Improved worker morale and retention", "Increased workplace hazards", "Reduced need for supervision"],
                    answer: 1,
                    explanation: "Safety practices boost morale by demonstrating employer care, improving retention and productivity."
                },
                {
                    q: "According to industrial safety principles, what is a direct outcome of effective safety measures?",
                    options: ["Increased absenteeism", "Lower healthcare and compensation costs", "Higher risk of accidents", "Reduced regulatory compliance"],
                    answer: 1,
                    explanation: "Effective safety measures reduce injuries, lowering medical and workers’ compensation expenses."
                },
                {
                    q: "What is a primary reason for prioritizing safety in mechanical operations?",
                    options: ["To comply with aesthetic standards", "To protect workers from mechanical hazards", "To increase machine production rates", "To simplify machine design"],
                    answer: 1,
                    explanation: "Safety practices shield workers from hazards like moving parts, sharp edges, or chemical exposure."
                },
                {
                    q: "How does safety training impact a mechanical workplace?",
                    options: ["It increases costs without benefits", "It equips workers to use equipment safely", "It eliminates the need for PPE", "It reduces machine maintenance needs"],
                    answer: 1,
                    explanation: "Training ensures workers understand safe equipment operation, reducing accident risks."
                },
                {
                    q: "What is a major consequence of neglecting safety practices in a mechanical environment?",
                    options: ["Increased worker productivity", "Higher risk of occupational injuries and fatalities", "Reduced need for safety audits", "Simplified equipment maintenance"],
                    answer: 1,
                    explanation: "Neglecting safety increases risks, with a reported 5% rise in preventable work deaths in 2022."
                },

                // 1.2.1 Personal Safety (5 MCQs)
                {
                    q: "What is the primary purpose of personal protective equipment (PPE) in a mechanical workshop?",
                    options: ["To enhance worker appearance", "To minimize exposure to workplace hazards", "To increase machine efficiency", "To reduce training requirements"],
                    answer: 1,
                    explanation: "PPE, like gloves and goggles, protects against hazards such as chemicals, debris, or mechanical risks."
                },
                {
                    q: "Which PPE is essential when working with loud machinery?",
                    options: ["Safety shoes", "Earplugs or earmuffs", "Hard hats", "Respirators"],
                    answer: 1,
                    explanation: "Earplugs or earmuffs prevent noise-induced hearing loss from loud machinery, per OSHA guidelines."
                },
                {
                    q: "What should be ensured when using safety goggles in a mechanical environment?",
                    options: ["They are brightly colored", "They fit comfortably and are free of scratches", "They are made of cloth material", "They are worn only during maintenance"],
                    answer: 1,
                    explanation: "Well-fitting, clear goggles provide effective eye protection without obstructing vision."
                },
                {
                    q: "What is a key precaution for personal safety when operating machinery?",
                    options: ["Wearing loose clothing for comfort", "Avoiding loose clothing or jewelry", "Using machines without guards", "Operating machines without training"],
                    answer: 1,
                    explanation: "Loose clothing or jewelry can get caught in machinery, causing serious injuries."
                },
                {
                    q: "Which practice ensures safe use of respirators in a mechanical workshop?",
                    options: ["Using any respirator regardless of fit", "Selecting hazard-appropriate respirators with proper fit", "Sharing respirators among workers", "Cleaning respirators monthly"],
                    answer: 1,
                    explanation: "Respirators must match the hazard and fit properly to protect against dust, fumes, or vapors."
                },

                // 1.2.2 Machine Safety (6 MCQs)
                {
                    q: "What is the purpose of machine guarding as per OSHA standards?",
                    options: ["To improve machine aesthetics", "To prevent injuries from moving parts", "To increase machine speed", "To reduce maintenance frequency"],
                    answer: 1,
                    explanation: "Machine guarding (29 CFR 1910.212) protects against hazards like rotating parts or flying debris."
                },
                {
                    q: "Which device ensures a machine cannot start during maintenance?",
                    options: ["Emergency stop button", "Lockout-tagout system", "Light curtain", "Two-hand control"],
                    answer: 1,
                    explanation: "Lockout-tagout systems isolate energy sources, preventing accidental startups during maintenance."
                },
                {
                    q: "What is a common hazard associated with unguarded machinery?",
                    options: ["Reduced noise levels", "Entanglement or amputation", "Improved productivity", "Lower energy consumption"],
                    answer: 1,
                    explanation: "Unguarded moving parts pose risks of entanglement, crushing, or amputation."
                },
                {
                    q: "How should emergency stop controls be designed for machine safety?",
                    options: ["Placed out of reach", "Easily accessible but resistant to accidental activation", "Used only during maintenance", "Made of fragile materials"],
                    answer: 1,
                    explanation: "Emergency stops (e.g., mushroom-head buttons) must be accessible but designed to avoid unintended use."
                },
                {
                    q: "What is a key requirement for machines designed for a fixed location?",
                    options: ["They must be lightweight", "They must be securely anchored", "They must lack guards", "They must be portable"],
                    answer: 1,
                    explanation: "Anchoring fixed machines prevents movement, ensuring stability and safety."
                },
                {
                    q: "Which safety measure reduces the risk of impact hazards from machine parts?",
                    options: ["Increasing machine speed", "Using proper guards and barriers", "Reducing operator training", "Ignoring maintenance schedules"],
                    answer: 1,
                    explanation: "Guards and barriers prevent workers from being struck by moving or ejected parts."
                },

                // 1.2.3 Tools Safety (5 MCQs)
                {
                    q: "What is a key safety practice when using a bench grinder?",
                    options: ["Using the side of the grinding wheel", "Keeping the tool rest within 1/8 inch of the wheel", "Operating without a tongue guard", "Holding small items by hand"],
                    answer: 1,
                    explanation: "A tool rest within 1/8 inch prevents workpieces from being caught between the wheel and rest."
                },
                {
                    q: "How should defective grinding wheels be handled?",
                    options: ["Used until they break", "Taken out of service and reported", "Repaired by the operator", "Stored without inspection"],
                    answer: 1,
                    explanation: "Defective wheels are hazardous and must be removed and reported for replacement."
                },
                {
                    q: "What safety device should be used when cutting with a table saw?",
                    options: ["A hood guard that adjusts to material thickness", "A loose-fitting cover", "A manual push stick only", "No guard for visibility"],
                    answer: 1,
                    explanation: "Adjustable hood guards protect against debris and blade contact on table saws."
                },
                {
                    q: "Why should small items be held with pliers during grinding?",
                    options: ["To improve grinding speed", "To keep hands away from the wheel", "To reduce noise levels", "To enhance tool durability"],
                    answer: 1,
                    explanation: "Pliers keep hands safely away from the grinding wheel, reducing injury risk."
                },
                {
                    q: "What is prohibited when using alloy steel chains with tools?",
                    options: ["Using chains with rated capacity", "Using makeshift fasteners like bolts", "Inspecting chains before use", "Annealing chains regularly"],
                    answer: 1,
                    explanation: "Makeshift fasteners are unsafe and prohibited for securing chains."
                },

                // 1.2.4 Workplace Safety (6 MCQs)
                {
                    q: "What is a key component of workplace safety in a mechanical environment?",
                    options: ["Ignoring minor risks", "Conducting thorough hazard assessments", "Reducing worker training", "Using non-compliant equipment"],
                    answer: 1,
                    explanation: "Hazard assessments identify risks, enabling effective control measures."
                },
                {
                    q: "What type of hazard is caused by poorly designed workstations?",
                    options: ["Chemical hazard", "Ergonomic hazard", "Biological hazard", "Electrical hazard"],
                    answer: 1,
                    explanation: "Poor workstation design causes ergonomic hazards, leading to musculoskeletal disorders."
                },
                {
                    q: "How can workplace safety be enhanced using technology?",
                    options: ["By removing safety devices", "By using inspection platforms like SafetyCulture", "By increasing hazard exposure", "By reducing ventilation"],
                    answer: 1,
                    explanation: "SafetyCulture and similar platforms streamline inspections and hazard reporting."
                },
                {
                    q: "What is a common cause of workplace injuries according to the National Safety Council?",
                    options: ["Excessive training", "Exposure to harmful environments", "Overuse of PPE", "Simplified machine designs"],
                    answer: 1,
                    explanation: "Harmful environments contribute to 36% of injuries, per NSC data."
                },
                {
                    q: "What should be done to control exposure to harmful dust in a workplace?",
                    options: ["Ignore ventilation systems", "Use local exhaust ventilation and respirators", "Increase dust production", "Avoid worker training"],
                    answer: 1,
                    explanation: "Ventilation and respirators minimize exposure to hazardous dust."
                },
                {
                    q: "What is a key administrative control for workplace safety?",
                    options: ["Scheduling high-exposure tasks with fewer workers", "Removing safety signs", "Ignoring ergonomic assessments", "Reducing maintenance"],
                    answer: 1,
                    explanation: "Scheduling reduces worker exposure to hazards during high-risk tasks."
                },

                // 1.3 Knowledge of Industrial Safety & Hygiene (5 MCQs)
                {
                    q: "What is the primary goal of industrial hygiene in a mechanical workplace?",
                    options: ["To increase production rates", "To anticipate, evaluate, and control hazards", "To reduce equipment maintenance", "To eliminate training"],
                    answer: 1,
                    explanation: "Industrial hygiene identifies and mitigates workplace hazards to protect worker health."
                },
                {
                    q: "Which organization sets standards for industrial hygiene in the U.S.?",
                    options: ["ANSI", "OSHA", "NSC", "AIHA"],
                    answer: 1,
                    explanation: "OSHA enforces workplace safety and hygiene standards under U.S. law."
                },
                {
                    q: "What is a key step in an industrial hygiene program?",
                    options: ["Ignoring minor hazards", "Conducting hazard identification", "Reducing PPE usage", "Avoiding worker feedback"],
                    answer: 1,
                    explanation: "Hazard identification is critical to developing effective hygiene controls."
                },
                {
                    q: "Which hazards does industrial hygiene address?",
                    options: ["Only chemical hazards", "Chemical, physical, biological, ergonomic", "Only ergonomic hazards", "Only electrical hazards"],
                    answer: 1,
                    explanation: "Industrial hygiene addresses a wide range of hazards impacting worker health."
                },
                {
                    q: "How can industrial hygienists reduce repetitive stress injuries (RSIs)?",
                    options: ["By increasing repetitive tasks", "By implementing ergonomic controls and training", "By removing ventilation", "By ignoring feedback"],
                    answer: 1,
                    explanation: "Ergonomic controls and training minimize RSIs in repetitive tasks."
                },

                // 1.4 Safety Tools & Devices (6 MCQs)
                {
                    q: "What is the function of a light curtain in a mechanical workshop?",
                    options: ["To improve lighting", "To detect worker presence and stop machinery", "To increase machine speed", "To reduce maintenance"],
                    answer: 1,
                    explanation: "Light curtains use photoelectric beams to halt machines when workers are detected."
                },
                {
                    q: "Which safety device isolates energy sources during maintenance?",
                    options: ["Emergency stop button", "Lockout-tagout system", "Two-hand control", "Safety mat"],
                    answer: 1,
                    explanation: "Lockout-tagout systems prevent accidental machine startups during maintenance."
                },
                {
                    q: "What is a characteristic of trapped key interlocks?",
                    options: ["They require no maintenance", "They control access through key exchanges", "They are used for lighting", "They increase hazard exposure"],
                    answer: 1,
                    explanation: "Trapped key interlocks ensure safe access via sequential key exchanges."
                },
                {
                    q: "What safety device provides instant visual feedback in a workshop?",
                    options: ["Respirator", "Indicator lights", "Hard hat", "Safety gloves"],
                    answer: 1,
                    explanation: "Indicator lights provide real-time safety status (e.g., red for active hazards)."
                },
                {
                    q: "What is a key requirement for safety guards on machinery?",
                    options: ["Easily removable by operators", "Prevent access to moving parts", "Made of fragile materials", "Increase machine noise"],
                    answer: 1,
                    explanation: "Guards must block access to dangerous parts to protect workers."
                },
                {
                    q: "Which safety tool is mandated for high-risk mechanical tasks?",
                    options: ["PPE", "Decorative signs", "Unsecured ladders", "Non-compliant fasteners"],
                    answer: 1,
                    explanation: "PPE is required for high-risk tasks to reduce hazard exposure."
                }
            ];

            let currentPage = 0;
            let score = 0;
            let skipped = [];
            let userAnswers = Array(questions.length).fill(null);
            let timerSeconds = 0;
            let timerInterval;
            const QUESTIONS_PER_PAGE = 5;
            const ANSWER_DELAY = 1000; // Reduced to 1 second for better UX

            const quizEl = document.getElementById("quiz");
            const scoreEl = document.getElementById("score");
            const resultsEl = document.getElementById("results");
            const resultsBody = document.getElementById("results-body");
            const progressEl = document.getElementById("progress");
            const timerEl = document.getElementById("timer");
            const currentScoreEl = document.getElementById("current-score");
            const correctSound = document.getElementById("correct-sound");
            const wrongSound = document.getElementById("wrong-sound");

            // Load progress from localStorage
            function loadProgress() {
                const saved = localStorage.getItem("quizProgressSafety");
                if (saved) {
                    const { currentPage: savedPage, score: savedScore, skipped: savedSkipped, answers: savedAnswers, time: savedTime } = JSON.parse(saved);
                    currentPage = savedPage;
                    score = savedScore;
                    skipped = savedSkipped;
                    userAnswers = savedAnswers || Array(questions.length).fill(null);
                    timerSeconds = savedTime || 0;
                    updateCurrentScore();
                }
            }

            // Save progress to localStorage
            function saveProgress() {
                localStorage.setItem("quizProgressSafety", JSON.stringify({
                    currentPage,
                    score,
                    skipped,
                    answers: userAnswers,
                    time: timerSeconds
                }));
            }

            // Update current score display
            function updateCurrentScore() {
                currentScoreEl.textContent = `Score: ${score}/${questions.length}`;
            }

            // Shuffle array
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Start timer
            function startTimer() {
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    const minutes = Math.floor(timerSeconds / 60);
                    const seconds = timerSeconds % 60;
                    timerEl.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    saveProgress();
                }, 1000);
            }

            // Update progress bar
            function updateProgress() {
                const answeredCount = userAnswers.filter(answer => answer !== null).length;
                const percentage = (answeredCount / questions.length) * 100;
                progressEl.style.width = `${percentage}%`;
            }

            // Show questions for the current page
            function showQuestions(page) {
                quizEl.innerHTML = '';
                const startIndex = page * QUESTIONS_PER_PAGE;
                const endIndex = Math.min(startIndex + QUESTIONS_PER_PAGE, questions.length);

                for (let i = startIndex; i < endIndex; i++) {
                    const q = questions[i];
                    const shuffledOptions = shuffle([...q.options].map((opt, j) => ({ text: opt, index: j })));
                    const optionsHtml = shuffledOptions
                        .map(opt => `<button onclick="checkAnswer(this, ${i}, ${opt.index}, '${opt.text.replace(/'/g, "\\'")}')">${opt.text}</button>`)
                        .join('');
                    const questionDiv = document.createElement('div');
                    questionDiv.classList.add('question');
                    questionDiv.dataset.index = i;
                    questionDiv.innerHTML = `
                        <p>Q${i + 1}. ${q.q}</p>
                        <div class="options">${optionsHtml}</div>
                        <button class="skip-button" onclick="skipQuestion(${i})">Skip</button>
                        <div class="explanation">${q.explanation}</div>
                    `;
                    quizEl.appendChild(questionDiv);
                }

                if (endIndex < questions.length || skipped.length > 0) {
                    const nextButton = document.createElement('button');
                    nextButton.classList.add('next-button');
                    nextButton.textContent = endIndex < questions.length ? 'Next' : 'Review Skipped Questions';
                    nextButton.onclick = nextPage;
                    nextButton.disabled = !areAllQuestionsAnsweredOnPage(startIndex, endIndex);
                    quizEl.appendChild(nextButton);
                } else {
                    const submitButton = document.createElement('button');
                    submitButton.classList.add('next-button');
                    submitButton.textContent = 'Submit Quiz';
                    submitButton.onclick = endQuiz;
                    submitButton.disabled = !areAllQuestionsAnsweredOnPage(startIndex, endIndex);
                    quizEl.appendChild(submitButton);
                }

                updateProgress();
                saveProgress();
                restoreAnswers(startIndex, endIndex);
            }

            // Restore previous answers for the current page
            function restoreAnswers(startIndex, endIndex) {
                for (let i = startIndex; i < endIndex; i++) {
                    if (userAnswers[i] !== null && userAnswers[i] !== 'Skipped') {
                        const questionDiv = document.querySelector(`.question[data-index="${i}"]`);
                        const buttons = questionDiv.querySelectorAll('.options button');
                        const q = questions[i];
                        buttons.forEach(btn => {
                            btn.disabled = true;
                            if (btn.textContent === q.options[q.answer]) {
                                btn.classList.add('correct');
                            }
                            if (btn.textContent === userAnswers[i] && userAnswers[i] !== q.options[q.answer]) {
                                btn.classList.add('wrong');
                            }
                        });
                        questionDiv.querySelector('.explanation').style.display = 'block';
                        questionDiv.querySelector('.skip-button').disabled = true;
                    } else if (userAnswers[i] === 'Skipped') {
                        const questionDiv = document.querySelector(`.question[data-index="${i}"]`);
                        questionDiv.querySelectorAll('.options button').forEach(btn => btn.disabled = true);
                        questionDiv.querySelector('.skip-button').disabled = true;
                        questionDiv.querySelector('.explanation').style.display = 'block';
                    }
                }
            }

            // Check if all questions on the current page are answered or skipped
            function areAllQuestionsAnsweredOnPage(startIndex, endIndex) {
                for (let i = startIndex; i < endIndex; i++) {
                    if (userAnswers[i] === null) {
                        return false;
                    }
                }
                return true;
            }

            // Check answer
            function checkAnswer(button, questionIndex, selected, selectedText) {
                const q = questions[questionIndex];
                const correct = q.answer;
                const buttons = button.parentElement.querySelectorAll("button");
                const questionDiv = button.closest('.question');
                const explanationDiv = questionDiv.querySelector('.explanation');

                buttons.forEach(btn => {
                    btn.disabled = true;
                    if (q.options.indexOf(btn.textContent) === correct) {
                        btn.classList.add('correct');
                    }
                    if (btn === button && selected !== correct) {
                        btn.classList.add('wrong');
                    }
                });

                questionDiv.querySelector('.skip-button').disabled = true;
                explanationDiv.style.display = 'block';

                userAnswers[questionIndex] = selectedText;
                if (selected === correct) {
                    score++;
                    correctSound.play().catch(() => console.log("Audio playback failed"));
                } else {
                    wrongSound.play().catch(() => console.log("Audio playback failed"));
                }

                updateCurrentScore();
                saveProgress();
                const nextButton = quizEl.querySelector('.next-button');
                if (nextButton) {
                    nextButton.disabled = !areAllQuestionsAnsweredOnPage(
                        currentPage * QUESTIONS_PER_PAGE,
                        Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                    );
                }

                setTimeout(() => {
                    if (areAllQuestionsAnsweredOnPage(
                        currentPage * QUESTIONS_PER_PAGE,
                        Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                    )) {
                        nextPage();
                    }
                }, ANSWER_DELAY);
            }

            // Skip question
            function skipQuestion(questionIndex) {
                if (!skipped.includes(questions[questionIndex])) {
                    skipped.push(questions[questionIndex]);
                    userAnswers[questionIndex] = 'Skipped';
                    const questionDiv = document.querySelector(`.question[data-index="${questionIndex}"]`);
                    questionDiv.querySelectorAll('.options button').forEach(btn => btn.disabled = true);
                    questionDiv.querySelector('.skip-button').disabled = true;
                    questionDiv.querySelector('.explanation').style.display = 'block';
                    saveProgress();
                    const nextButton = quizEl.querySelector('.next-button');
                    if (nextButton) {
                        nextButton.disabled = !areAllQuestionsAnsweredOnPage(
                            currentPage * QUESTIONS_PER_PAGE,
                            Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                        );
                    }
                }
            }

            // Move to next page
            function nextPage() {
                if (skipped.length > 0 && currentPage * QUESTIONS_PER_PAGE >= questions.length) {
                    showSkippedQuestions();
                } else {
                    currentPage++;
                    if (currentPage * QUESTIONS_PER_PAGE < questions.length) {
                        showQuestions(currentPage);
                    } else if (skipped.length === 0) {
                        endQuiz();
                    } else {
                        showSkippedQuestions();
                    }
                }
            }

            // Show skipped questions
            function showSkippedQuestions() {
                questions.splice(0, questions.length, ...skipped);
                skipped = [];
                currentPage = 0;
                showQuestions(currentPage);
            }

            // End quiz and show results
            function endQuiz() {
                clearInterval(timerInterval);
                quizEl.innerHTML = '';
                scoreEl.textContent = `Final Score: ${score} out of ${questions.length} (${((score / questions.length) * 100).toFixed(2)}%)`;
                resultsEl.classList.remove('hidden');

                resultsBody.innerHTML = questions.map((q, i) => {
                    const userAnswer = userAnswers[i] === null ? 'Not attempted' :
                                      userAnswers[i] === 'Skipped' ? 'Skipped' :
                                      userAnswers[i];
                    const correctAnswer = q.options[q.answer];
                    const status = userAnswers[i] === q.options[q.answer] ? 'Correct' :
                                  userAnswers[i] === 'Skipped' ? 'Skipped' :
                                  userAnswers[i] === null ? 'Not attempted' : 'Wrong';
                    return `
                        <tr>
                            <td>${i + 1}. ${q.q}</td>
                            <td>${userAnswer}</td>
                            <td>${correctAnswer}</td>
                            <td class="${status.toLowerCase().replace(' ', '-')}">${status}</td>
                            <td class="explanation">${q.explanation}</td>
                        </tr>
                    `;
                }).join('');

                localStorage.removeItem('quizProgressSafety');
            }

            // Restart quiz
            function restartQuiz() {
                currentPage = 0;
                score = 0;
                skipped = [];
                userAnswers = Array(questions.length).fill(null);
                timerSeconds = 0;
                resultsEl.classList.add('hidden');
                scoreEl.textContent = '';
                localStorage.removeItem('quizProgressSafety');
                startTimer();
                showQuestions(currentPage);
                updateCurrentScore();
            }

            // Initialize
            loadProgress();
            startTimer();
            showQuestions(currentPage);
        </script>
    </body>
</html>
